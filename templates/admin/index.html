{% extends "admin/base_site.html" %}
{% load i18n static %}

{% block content %}
<div class="container-fluid" style="padding-top: 30px; padding-bottom: 50px;">
    
    <div class="row mb-4">
        <div class="col-12">
            <h2 class="m-0 text-dark" style="font-weight: 300;">Dashboard Overview</h2>
            <p class="text-muted">Pantau performa agency lo secara real-time di sini.</p>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-4 col-6">
            <div class="small-box bg-info">
                <div class="inner">
                    <h3>{{ total_leads }}</h3>
                    <p>Total Leads Masuk</p>
                </div>
                <div class="icon">
                    <i class="fas fa-user-plus"></i>
                </div>
            </div>
        </div>

        <div class="col-lg-4 col-6">
            <div class="small-box bg-success">
                <div class="inner">
                    <h3>{{ total_deals }}</h3>
                    <p>Closing (Deal)</p>
                </div>
                <div class="icon">
                    <i class="fas fa-handshake"></i>
                </div>
            </div>
        </div>

        <div class="col-lg-4 col-12">
            <div class="small-box bg-warning">
                <div class="inner">
                    <h3>Rp {{ potential_revenue|floatformat:0 }}</h3>
                    <p>Estimasi Omzet</p>
                </div>
                <div class="icon">
                    <i class="fas fa-money-bill-wave"></i>
                </div>
            </div>
        </div>
    </div>

    <div class="row mt-4">
        
        <div class="col-md-6">
            <div class="card card-outline card-primary">
                <div class="card-header">
                    <h3 class="card-title">ðŸ“Š Funnel Status</h3>
                    <div class="card-tools">
                        <button type="button" class="btn btn-tool" data-card-widget="collapse"><i class="fas fa-minus"></i></button>
                    </div>
                </div>
                <div class="card-body">
                    <canvas id="statusChart" style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card card-outline card-purple">
                <div class="card-header">
                    <h3 class="card-title">ðŸ’» Teknologi Favorit</h3>
                    <div class="card-tools">
                        <button type="button" class="btn btn-tool" data-card-widget="collapse"><i class="fas fa-minus"></i></button>
                    </div>
                </div>
                <div class="card-body">
                    <canvas id="techChart" style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
                </div>
            </div>
        </div>
    </div>

    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header border-0">
                    <h3 class="card-title">Quick Actions</h3>
                </div>
                <div class="card-body p-0">
                    {% include "admin/app_list.html" with app_list=app_list show_changelinks=True %}
                </div>
            </div>
        </div>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // --- STATUS CHART (DONUT) ---
    const ctxStatus = document.getElementById('statusChart').getContext('2d');
    new Chart(ctxStatus, {
        type: 'doughnut',
        data: {
            labels: {{ status_labels|safe }},
            datasets: [{
                data: {{ status_counts|safe }},
                backgroundColor: ['#3c8dbc', '#f56954', '#00a65a', '#f39c12', '#00c0ef', '#d2d6de'],
            }]
        },
        options: { maintainAspectRatio: false, responsive: true }
    });

    // --- TECH CHART (BAR) ---
    const ctxTech = document.getElementById('techChart').getContext('2d');
    new Chart(ctxTech, {
        type: 'bar',
        data: {
            labels: {{ tech_labels|safe }},
            datasets: [{
                label: 'Jumlah Website',
                data: {{ tech_counts|safe }},
                backgroundColor: '#605ca8',
                borderColor: '#605ca8',
                borderWidth: 1
            }]
        },
        options: {
            maintainAspectRatio: false, responsive: true,
            scales: { y: { beginAtZero: true } }
        }
    });
</script>
{% endblock %}